<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />

    <link rel="stylesheet" href="./style/index.css" />
    <link rel="stylesheet" href="./style/carrinho.css" />
    <link rel="icon" href="../content/Icon.png" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Lobster&family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&display=swap"
        rel="stylesheet">
    <title>Carrinho</title>


</head>

<body>

    <nav class="navbar_loja">
        <div class="navbar_component_loja">
            <h1 class="navbar_titulo_loja" onclick="home()">Loja Maneira</h1>
        </div>
    </nav>

    <section class="body_compras">

        <div class="produtos_section_carrinho">
            <div class="produtos_container">
                <h1 class="titulo"> Carrinho </h1>
            </div>
        </div>

        <div id="carrinho" class="produtos_section_carrinho">


            <script>
                let roupas = JSON.parse(sessionStorage.getItem("Carrinho")); //*procura se existe json roupa dentro do local
                const container = document.getElementById("carrinho");
                container.innerHTML = roupas.map(produto => `
                    <div class="produtos_container">
                      <img class="produtos_section_img_up" src="${produto.img}" />
                    
                      <div class="produtos_section_text">
                          <p>${produto.nome}</p>
                          <p>R$ ${produto.preco.toFixed(2)}</p>
                      </div>
                      
                      <div class="produtos_section_text">
                          <p>${produto.quantidade}</p>
                      </div>
                      <div class="produtos_section_text">
                          <p>Sub total:</p>
                          <p>R$ ${(produto.quantidade * produto.preco).toFixed(2)}</p>
                      </div>
                      <div class="produtos_section_text">
                          <button class="remover_item" onclick="remover(${produto.id})"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M292.31-140Q262-140 241-161q-21-21-21-51.31V-720h-40v-60h180v-35.38h240V-780h180v60h-40v507.69Q740-182 719-161q-21 21-51.31 21H292.31Zm83.85-140h59.99v-360h-59.99v360Zm147.69 0h59.99v-360h-59.99v360Z"/></svg></button>
                      </div>
                    </div>
                `)
                    .join("");
            </script>
        </div>

        <div class="produtos_section_carrinho">
            <div id="comprar" class="produtos_container">
                <script>
                    const button = document.getElementById("comprar");
                    const buttonValor = roupas
                        .reduce((acc, produto) => acc + (produto.quantidade * produto.preco), 0)
                        .toFixed(2);
                    if (buttonValor > 0) {
                        button.innerHTML = `
                              <button class="comprar_input" onclick="finalizar_compra()"> Comprar </button>
                            `;
                    } else {
                        button.innerHTML = `
                              <button class="comprar_input disabled" disabled="disabled"> Comprar </button>
                            `;
                    }
                </script>
                <p id="total">
                    <script>
                        const total = document.getElementById("total");
                        const totalValor = roupas
                            .reduce((acc, produto) => acc + (produto.quantidade * produto.preco), 0)
                            .toFixed(2);

                        total.innerHTML = `
                          <p>
                            R$ ${totalValor}
                          </p>
                        `;
                    </script>
                    <script>
                        function finalizar_compra() {
                            const totalValor = roupas
                                .reduce((acc, produto) => acc + (produto.quantidade * produto.preco), 0)
                                .toFixed(2);
                            if (totalValor > 0) {
                                alert("Compra Realizada!");
                                sessionStorage.removeItem("Carrinho");
                                window.location.href = "../index.html"
                            } else {
                                alert("Pra comprar tem que ter algo né menó");
                            }

                        }
                    </script>

                    <script>
                        function remover(id) {
                            let carrinho = JSON.parse(sessionStorage.getItem("Carrinho")) || [];
                            const existente = carrinho.find(item => item.id == id);
                            if (existente && existente.quantidade > 1) {
                                existente.quantidade -= 1;
                            } else {
                                carrinho = carrinho.filter(item => item.id != id);
                            }
                            sessionStorage.setItem("Carrinho", JSON.stringify(carrinho));
                            window.location.reload()
                        }


                    </script>
                </p>
            </div>
        </div>

    </section>
</body>

<script>
    function home() {
        window.location.href = "../index.html";
    }
</script>
</html>