<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />

  <link rel="stylesheet" href="./loja/style/index.css" />
  <link rel="icon" href="../content/Icon.png" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Lobster&family=Roboto+Serif:ital,opsz,wght@0,8..144,100..900;1,8..144,100..900&display=swap"
    rel="stylesheet">
  <title>Roupa Maneira</title>

</head>

<body>

  <nav class="navbar_loja">
    <div class="navbar_component_loja">
      <h1 class="navbar_titulo_loja">Loja Maneira</h1>
    </div>
    <div class="navbar_input_loja">
      <input type="text" placeholder="Pesquisa"></input>
      <svg class="navbar_svg" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
        fill="#e3e3e3">
        <path
          d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" />
      </svg>
      <div>

      </div>
      <img class="navbar_carrinho" src="../content/carrinho.png" />
    </div>
  </nav>

  <section id="body_compras" class="body_compras">
    <div id="carouselExampleIndicators" class="carousel slide">
      <ol class="carousel-indicators">
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"></li>
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"></li>
        <li data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"></li>
      </ol>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img class="d-block w-100" src="../content/carrossel1.png" alt="Primeiro Slide">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="../content/carrossel2.png" alt="Segundo Slide">
        </div>
        <div class="carousel-item">
          <img class="d-block w-100" src="../content/carrossel3.png" alt="Terceiro Slide">
        </div>
      </div>
      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Próximo</span>
      </a>
    </div>

    <div id="produtos" class="produtos_section">
      <script>
        let roupas = JSON.parse(localStorage.getItem("Roupas")); //*procura se existe json roupa dentro do local
        if (!roupas) {
          roupas = [
            {
              id: 1,
              nome: "Camisa Azul",
              preco: 59.90,
              imgUp: "https://via.placeholder.com/300x400?text=Camisa+Azul+Up",
              imgDown: "https://via.placeholder.com/300x400?text=Camisa+Azul+Down"
            },
            {
              id: 2,
              nome: "Jaqueta Preta",
              preco: 149.90,
              imgUp: "https://via.placeholder.com/300x400?text=Jaqueta+Preta+Up",
              imgDown: "https://via.placeholder.com/300x400?text=Jaqueta+Preta+Down"
            },
            {
              id: 3,
              nome: "Moletom Branco",
              preco: 129.90,
              imgUp: "https://via.placeholder.com/300x400?text=Moletom+Branco+Up",
              imgDown: "https://via.placeholder.com/300x400?text=Moletom+Branco+Down"
            }
          ];  //*Declara a variavel roupa
          localStorage.setItem("Roupas", JSON.stringify(roupas)); //* Salva a json
        }
        const admin = localStorage.getItem("Admin")
        if (admin) {
          const container = document.getElementById("produtos");
          container.innerHTML = roupas.map(produto => `
              <div class="produtos_container">
                  <p onclick="alterarProduto(${produto.id})">EDITAR</p>
                  <img class="produtos_section_img_up" src="${produto.imgUp}" />
                  <img class="produtos_section_img_down" src="${produto.imgDown}" />
              
                  <div class="produtos_section_text">
                      <p>${produto.nome}</p>
                      <p>R$ ${produto.preco.toFixed(2)}</p>
                  </div>
              </div>
            `)
            .join("");
        }
        else {
          const container = document.getElementById("produtos");
          container.innerHTML = roupas.map(produto => `
            <div class="produtos_container">
                <img class="produtos_section_img_up" src="${produto.imgUp}" />
                <img class="produtos_section_img_down" src="${produto.imgDown}" />
            
                <div class="produtos_section_text">
                    <p>${produto.nome}</p>
                    <p>R$ ${produto.preco.toFixed(2)}</p>
                </div>
            </div>
          `)
            .join("");
        }
      </script>
    </div>
    </div>

    <footer class="footer">
      <div class="footer_component_loja">
        <h1 class="footer_titulo_loja">Loja Maneira</h1>

        <div class="footer_input">
          <a class="base_input" href="../sobre/sobre.html">Sobre Nós</a>
          <a class="base_input texto_sublinhado" href="./index.html">Home</a>
          <a class="base_input" onclick="verificarAdmin()">Admin</a>

        </div>

    </footer>
  </section>

</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  function verificarAdmin() {
    const admin = localStorage.getItem('Admin')
    if (admin) {
      window.location.href = "../admin/admin_index.html";
    }
    else {
      window.location.href = "../admin/admin.html";
    }
  }
  function alterarProduto(id) {
    // Pega o array de produtos
    let roupas = JSON.parse(localStorage.getItem("Roupas"));

    // Procura o produto com o ID solicitado
    const produto = roupas.find(item => item.id == id);

    // Insere o HTML no container
    const container = document.getElementById("body_compras");
    container.innerHTML = `
        <form class="form_login">
            <h1 class="titulo">Alterar Produto</h1>
            <section>
                <div>
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" value="${produto.nome}" required>
                </div>

                <div>
                    <label for="preco">Preço:</label>
                    <input type="text" id="preco" value="${produto.preco.toString().replace(".", ",")}" required>
                </div>

                <div>
                    <label for="imgUp">Imagem Principal:</label>
                    <input type="text" id="imgUp" value="${produto.imgUp}" required>
                </div>

                <div>
                    <label for="imgDown">Imagem Secundária:</label>
                    <input type="text" id="imgDown" value="${produto.imgDown}" required>
                </div>
            </section>
            <button type="submit">Salvar Alterações</button>
        </form>
    `;
    document.getElementById("preco").addEventListener("input", function () {
      this.value = this.value.replace(/[^0-9,]/g, "");

      const partes = this.value.split(",");
      if (partes.length > 2) {
        this.value = partes[0] + "," + partes[1];
      }
    });

    // Adiciona evento ao form para salvar as edições
    const form = container.querySelector(".form_login");

    form.addEventListener("submit", function (event) {
      event.preventDefault();

      // Atualiza valores
      produto.nome = document.getElementById("nome").value.trim();
      produto.preco = Number(document
        .getElementById("preco")
        .value.trim()
        .replace(",", "."));
      produto.imgUp = document.getElementById("imgUp").value.trim();
      produto.imgDown = document.getElementById("imgDown").value.trim();

      // Salva no localStorage
      localStorage.setItem("Roupas", JSON.stringify(roupas));

      alert("Produto alterado com sucesso!");
      window.location.reload();
    });
  }

</script>

<script>
  var myCarousel = document.querySelector('#carouselExampleIndicators');
  var carousel = new bootstrap.Carousel(myCarousel, {
    interval: 3000,
    wrap: true
  }); 
  
</script>

</html>